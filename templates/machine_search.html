{% extends "base.html" %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
  <h1>Machine Search</h1>
</div>

<form method="get" action="{{ url_for('search_machines') }}" style="margin-bottom: 2rem;">
  <div style="display: flex; gap: 1rem; align-items: center; max-width: 600px;">
    <input type="text" name="q" placeholder="Search by model or serial number..." value="{{ query or '' }}" style="flex: 1; padding: 0.75rem 1rem; border-radius: 8px; border: 2px solid #e2e8f0; font-size: 0.9rem;">
    <button type="submit" class="btn btn-primary">Search</button>
    {% if query %}
      <a href="{{ url_for('search_machines') }}" class="btn btn-secondary">Clear</a>
    {% endif %}
  </div>
</form>

{% if machines %}
  <table>
    <thead>
      <tr>
        <th>Model</th>
        <th>Serial Number</th>
        <th>Company</th>
        <th>Last Job Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
    {% for machine in machines %}
      <tr>
        <td><strong>{{ machine.model or '—' }}</strong></td>
        <td>
          {% if machine.serial_number %}
            <code style="background: #f7fafc; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">{{ machine.serial_number }}</code>
          {% else %}
            —
          {% endif %}
        </td>
        <td>{{ machine.customer_name or 'N/A' }}</td>
        <td>{{ machine.last_job_date|aus_date if machine.last_job_date else 'No jobs' }}</td>
        <td>
          <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: nowrap;">
            {% if machine.serial_number %}
              <a class="btn btn-small btn-primary" href="{{ url_for('machine_jobs', serial_number=machine.serial_number) }}">View Jobs →</a>
            {% else %}
              <span style="color: #a0aec0; margin-right: 0.5rem;">No serial</span>
            {% endif %}
            <a class="btn btn-small" href="{{ url_for('edit_machine_base', machine_id=machine.id) }}" style="background: #f59e0b; color: white; border: none;">Edit</a>
            <form method="post" action="{{ url_for('delete_machine_base', machine_id=machine.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this machine? This will only work if it has no job associations.');">
              <button type="submit" class="btn btn-small" style="background: #f56565; color: white; border: none;">Delete</button>
            </form>
          </div>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% elif query %}
  <div class="empty-state">
    <p>No machines found matching "{{ query }}".</p>
  </div>
{% else %}
  <div class="empty-state">
    <p>Enter a model number or serial number to search for machines.</p>
  </div>
{% endif %}
{% endblock %}

